================
Functional tests
================

We create the test browser

    >>> from zope.testbrowser.testing import Browser
    >>> browser = Browser()

We need to add an Eztranet Site as a global manager.
So we load the adding page::

    >>> browser.addHeader('Authorization', 'Basic globalmgr:globalmgrpw')
    >>> browser.addHeader('Accept-Language', 'en-US')
    >>> browser.open('http://localhost/++skin++Rotterdam/+/eztranet.eztranet.EztranetSite')
    >>> browser.headers['status'] == '200 Ok'
    True

We fill in the form::

    >>> browser.getControl(name='form.__name__').value = 'eztranet'
    >>> browser.getControl(name='form.title').value = 'My Eztranet Site'
    >>> browser.getControl(name='form.actions.add').click()

We should have both an EztranetSite object and a 'projects' subfolder::

    >>> root = getRootFolder()
    >>> 'projects' in root['eztranet']
    True

We also have a new 'admin' user in an auth folder::

    >>> from zope.app.component.hooks import getSiteManager
    >>> sm = getSiteManager(root['eztranet'])
    >>> 'admin' in sm['authentication']['EztranetUsers']
    True

We can now visit the eztranet site::

    >>> del browser
    >>> browser = Browser()
    >>> browser.open('http://localhost/eztranet')
    >>> browser.headers['status'] == '200 Ok'
    True
    >>> 'Eztranet demo' in browser.contents
    True

We cannot yet visit the projects, and we are redirected
to a login page::

    >>> browser.open('http://localhost/eztranet/projects/')
    >>> print browser.contents
    <html ...
    <input type="text" name="login" id="login" />
    ...

We fill in the user and password::

    >>> browser.getControl(name='login').value = 'admin'
    >>> browser.getControl(name='password').value = 'eztranet'
    >>> browser.getControl(name='SUBMIT').click()
    >>> browser.headers['status'] == '200 Ok'
    True

Now we are in the projects page::

    >>> browser.url
    'http://localhost/eztranet/projects/@@index.html'

We add two projects::

    >>> browser.getLink(url='+/eztranet.add.Project').click()
    >>> browser.getControl(name='form.title').value = u'   @@@ ++++  '
    >>> browser.getControl(name='form.description').value = u'project1 description'
    >>> browser.getControl(name='form.actions.add').click()
    >>> 'Project' in root['eztranet']['projects']
    True
    >>> browser.getLink(url='+/eztranet.add.Project').click()
    >>> browser.getControl(name='form.title').value = u'project 2'
    >>> browser.getControl(name='form.description').value = u'project2 description'
    >>> browser.getControl(name='form.actions.add').click()
    >>> [p in root['eztranet']['projects'] for p in ('Project','project-2')]
    [True, True]

In each project we add a subproject. We don't try to upload an image or a video
because zope.app.testing.functional does not support blobstorage yet (#219845)

    >>> browser.getLink('Project').click()
    >>> browser.getLink(url='+/eztranet.add.Project', index=1).click()
    >>> browser.getControl(name='form.title').value = u'subproject'
    >>> browser.getControl(name='form.description').value = u'subproject description'
    >>> browser.getControl(name='form.actions.add').click()
    >>> 'subproject' in root['eztranet']['projects']['Project']
    True





